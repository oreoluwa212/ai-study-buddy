<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>StudyPal - AI Flashcard Generator</title>
    <link rel="icon" href="./assets/favicon.svg" type="image/svg+xml">
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <div class="container">
      <header class="header">
        <h1>StudyPal</h1>
        <p>Transform your notes into interactive flashcards using AI</p>
      </header>

      <div class="stats">
        <div class="stat-item">
          <span class="stat-number" id="cardsGenerated">0</span>
          <span class="stat-label">Cards Generated</span>
        </div>
        <div class="stat-item">
          <span class="stat-number" id="studySessions">1</span>
          <span class="stat-label">Study Sessions</span>
        </div>
        <div class="stat-item">
          <span class="stat-number" id="savedSets">0</span>
          <span class="stat-label">Saved Sets</span>
        </div>
      </div>

      <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
          <h3>Saved Card Sets</h3>
          <button class="close-sidebar" onclick="toggleSidebar()">×</button>
        </div>
        <div class="sidebar-content" id="sidebarContent">
          <div class="loading-saved" id="loadingSaved">
            Loading saved sets...
          </div>
        </div>
      </div>

      <button class="sidebar-toggle" id="sidebarToggle" onclick="toggleSidebar()">
        Saved Sets
      </button>

      <div class="workspace">
        <div class="panel">
          <h2>📝 Your Study Notes</h2>

          <div class="textarea-container">
            <textarea
              id="studyNotes"
              class="study-textarea"
              placeholder="Paste your study material here...

Example:
Machine learning is a subset of artificial intelligence that enables computers to learn and make decisions from data without being explicitly programmed. It uses algorithms to identify patterns in data and make predictions or decisions based on these patterns."
            ></textarea>
            <div class="word-count"><span id="wordCount">0</span> words</div>
          </div>

          <div class="buttons">
            <button class="btn btn-primary" id="generateBtn" onclick="generateFlashcards()">
              Generate Flashcards
            </button>
            <button class="btn btn-secondary" id="saveBtn" onclick="saveFlashcards()" disabled>
              Save Cards
            </button>
          </div>

          <div class="loading" id="loading">
            <div>AI is analyzing your notes...</div>
            <div style="margin-top: 10px">This may take a few moments</div>
          </div>

          <div id="messageArea"></div>
        </div>

        <div class="panel">
          <h2>🎴 Study Flashcards</h2>

          <div class="flashcards-container" id="flashcardsContainer">
            <div class="empty-state">
              <span class="icon">📚</span>
              <h3>Ready to Learn?</h3>
              <p>Your AI-generated flashcards will appear here</p>
            </div>
          </div>

          <div class="controls" id="controls" style="display: none">
            <button class="control-btn" id="prevBtn" onclick="previousCard()">
              ←
            </button>

            <div class="card-counter">
              <span id="currentCard">1</span> / <span id="totalCards">0</span>
            </div>

            <button class="control-btn" id="nextBtn" onclick="nextCard()">
              →
            </button>
          </div>

          <div class="card-actions" id="cardActions" style="display: none">
            <button class="action-btn know-btn" onclick="markCard('know')">
              ✓ I Know This
            </button>
            <button class="action-btn study-btn" onclick="markCard('study')">
              📖 Study More
            </button>
            <button class="action-btn shuffle-btn" onclick="shuffleCards()">
              🔀 Shuffle
            </button>
          </div>
        </div>
      </div>

      <div class="instructions">
        <h3>How to Use:</h3>
        <ol>
          <li>Paste your study notes in the text area</li>
          <li>Click "Generate Flashcards" to create AI-powered questions</li>
          <li>Use arrow keys or buttons to navigate</li>
          <li>Click cards to flip between question and answer</li>
          <li>Save your card sets and access them anytime from the sidebar</li>
        </ol>
      </div>
    </div>

    <div class="modal-overlay" id="paymentModal">
      <div class="modal-content">
        <div class="modal-header">
          <h2>Upgrade to StudyPal Premium</h2>
          <button class="modal-close" onclick="closePaymentModal()">×</button>
        </div>

        <div class="modal-body">
          <div class="premium-features">
            <h3>Premium Features</h3>
            <ul class="feature-list">
              <li>Unlimited flashcard generation</li>
              <li>Generate up to 10 cards per session</li>
              <li>Unlimited saved sets</li>
              <li>Premium content access</li>
              <li>Advanced study analytics</li>
              <li>Smart shuffle algorithms</li>
            </ul>
          </div>

          <div class="pricing-options">
            <div class="price-card active" data-plan="monthly">
              <h4>Monthly Plan</h4>
              <div class="price">KES 500<span>/month</span></div>
              <p>Perfect for regular learners</p>
            </div>

            <div class="price-card" data-plan="yearly">
              <h4>Yearly Plan</h4>
              <div class="price">KES 5,000<span>/year</span></div>
              <p>Save 17% - Best value!</p>
              <div class="badge">Most Popular</div>
            </div>
          </div>

          <div class="user-info">
            <input
              type="email"
              id="modalUserEmail"
              placeholder="Enter your email address"
              class="email-input"
              required
            />
          </div>

          <div class="payment-loading" id="paymentLoading" style="display: none">
            <div class="spinner"></div>
            <p>Setting up your payment...</p>
          </div>

          <div class="payment-error" id="paymentError" style="display: none">
            <p>Payment failed. Please try again.</p>
          </div>

          <div class="payment-success" id="paymentSuccess" style="display: none">
            <div class="success-icon">Payment Successful!</div>
            <h3>Payment Successful!</h3>
            <p>Welcome to StudyPal Premium! Your account has been upgraded.</p>
          </div>
        </div>

        <div class="modal-footer">
          <button class="btn btn-secondary" onclick="closePaymentModal()">
            Cancel
          </button>
          <button class="btn btn-primary payment-btn" id="proceedPaymentBtn" onclick="initiatePayment()">
            Continue to Payment
          </button>
        </div>
      </div>
    </div>

    <script src="script.js"></script>

    <script>
      const urlParams = new URLSearchParams(window.location.search);
      const paymentStatus = urlParams.get("payment_status");
      const paymentId = urlParams.get("payment_id");

      if (paymentStatus === "success" && paymentId) {
        setTimeout(() => {
          if (window.StudyBuddy && window.StudyBuddy.handlePaymentSuccess) {
            window.StudyBuddy.handlePaymentSuccess({ id: paymentId });
          }
        }, 1000);
      } else if (paymentStatus === "failed") {
        setTimeout(() => {
          if (window.StudyBuddy && window.StudyBuddy.showMessage) {
            window.StudyBuddy.showMessage(
              "Payment was not completed. Please try again.",
              "error"
            );
          }
        }, 1000);
      }
    </script>
  </body>
</html>